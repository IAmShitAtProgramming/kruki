<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KRUKI - Gra i Zasady</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
</head>
<body>

    <header>
        <h1>KRUKI</h1>
    </header>

    <div class="container">
        <div id="game-setup">
            <h2>Nowa Gra</h2>
            <div class="input-group">
                Liczba graczy: <input type="number" id="players-count" value="3" min="2" max="8" onchange="updateNameInputs()">
                Liczba talii: <input type="number" id="decks-count" value="1" min="1" max="5">
            </div>
            <div class="input-group">
                Tryb gry: <select id="game-mode" style="background: #2d3339; border: 1px solid #7a8c99; color: white; padding: 8px; border-radius: 4px;">
                    <option value="learning">Nauka (z podpowiedziami)</option>
                    <option value="competitive">Kompetetywny (bez podpowiedzi)</option>
                </select>
            </div>
            <div id="player-names-container" class="input-group" style="display: flex; flex-wrap: wrap; justify-content: center; gap: 10px;">
                <!-- Inputs generated by JS -->
            </div>
            <button onclick="enterLayoutMode()" class="btn-secondary" style="margin-right: 10px;">Ustaw stół</button>
            <button onclick="startGame()">Rozpocznij Rozgrywkę</button>
        </div>

        <div id="game-board" style="display: none;">
            <div id="table-center">
                <div id="last-card-container">
                    <span style="color: #444;">STOS</span>
                </div>
                <div id="slap-alert" style="display: none;">RĘCE NA STOS!</div>
            </div>

            <div id="action-area">
                <div id="action-text"></div>
            </div>

            <div id="penalty-area" style="display: none;">
                <h3>Kto przegrał rundę?</h3>
                <div id="penalty-buttons"></div>
            </div>
            
            <div id="btn-end-round-container" style="text-align: center; margin-top: 10px;">
                <button onclick="showPenaltyControls()" class="btn-secondary" style="font-size: 0.9rem;">Zakończ Rundę / Zgłoś Kruczek</button>
            </div>

            <div id="current-info">
                Kolej gracza: <span id="active-player-name">1</span>
                <br>
                <small id="direction-info">Kierunek: Lewo</small>
            </div>

            <div class="players-container" id="players-container"></div>
            
            <div id="btn-reset-container" style="text-align:center; margin-top: 20px;">
                <button onclick="resetGame()" class="btn-secondary">Zresetuj Grę</button>
            </div>
        </div>

        <hr class="separator">

        <section class="rules">
            <h2>Zasady Gry</h2>
            
            <h3>Materiały</h3>
            <p>Standardowe talie kart do gry (im więcej tym lepiej) bez jokerów. Pusty stół.</p>

            <h3>Przygotowanie i początek gry</h3>
            <ul>
                <li>Przed grą należy zdjąć całą biżuterię z dłoni (z wyjątkiem pierścionków zaręczynowych).</li>
                <li>Karty należy potasować i rozdzielić po równo między graczy.</li>
                <li>Przed każdym z graczy powinien leżeć stos kart obróconych tyłem do góry. Kart nie należy podglądać.</li>
                <li>Należy wybrać gracza, który rozpocznie rozgrywkę poprzez wyłożenie pierwszej karty.</li>
            </ul>

            <h3>Przebieg rundy</h3>
            <p>Gracze wykładają kolejno karty na środek stołu (domyślnie w kierunku przeciwnym do ruchu wskazówek zegara).</p>
            <p>Każda karta oprócz pierwszej powinna zostać położona dokładnie na poprzedniej karcie.</p>
            <p>Runda kończy się gdy:</p>
            <ul>
                <li>Odbędzie się <strong>“Ręce na stos”</strong>.</li>
                <li>Któryś z graczy zgłosi <strong>“Kruczek prawny”</strong>.</li>
            </ul>
            <p>Przegrany rundy zbiera karty ze środka, dokłada je na dół swojej kupki oraz rozpoczyna kolejną rundę.</p>
            
            <h3>Ręce na stos</h3>
            <p>Odbywa się gdy:</p>
            <ul>
                <li>Wyłożono dwie karty o tym samym nominale (para).</li>
                <li>Nominał karty odpowiada liczbie kart na stole (modulo 13).</li>
            </ul>
            <p>Polega ono na próbie położenia przez każdego z graczy ręki na stosie kart po środku. Ostatnia osoba, która położy rękę na stosie (zwykle osoba, której ręka jest na wierzchu) przegrywa rundę.</p>
            <p><strong>Uwaga:</strong> Nie wolno trzymać karty w ręce przy kładzeniu dłoni na stos.</p>
            <p>W przypadku remisu gracze grają w “wojnę” wykładając karty ze swoich talii aż któryś wyłoży kartę o wyższym nominale. Przegrany zabiera dodatkowo wszystkie karty użyte w wojnie.</p>

            <h3>Akcje (Kruki)</h3>
            <p><strong>Narrator:</strong> Osoba wykładająca kartę musi powiedzieć, która jest to karta na stosie (modulo 13).</p>
            <table>
                <thead>
                    <tr><th>Karta</th><th>Trudność</th><th>Akcja</th></tr>
                </thead>
                <tbody>
                    <tr><td>As</td><td>✧</td><td><strong>As przestworzy:</strong> Osoba wykładająca asa musi zakrakać “KRA” niczym kruk.</td></tr>
                    <tr><td>Walet</td><td>✧</td><td><strong>Zawrotny Walet:</strong> Zmienia kierunek wykonywania ruchów.</td></tr>
                    <tr><td>Dama</td><td>✧</td><td><strong>Biedna Dama:</strong> Osoba, która ją wyłoży musi uderzyć w wyłożoną damę otwartą dłonią.</td></tr>
                    <tr><td>Król</td><td>✧✧</td><td><strong>Zapowiedź Króla:</strong> Osoba, która wyłożyła kartę przed królem musi powiedzieć “Bong”.</td></tr>
                    <tr><td>Siódemka</td><td>✧✧</td><td><strong>(Nie)szczęśliwa Siódemka:</strong> Osoba, która wyłoży siódemkę musi wyłożyć kolejną kartę.</td></tr>
                    <tr><td>Czwórka</td><td>✧✧✧</td><td><strong>Cicha Czwórka:</strong> Kart wyłożonych po czwórce nie należy odczytywać na głos. Zasada obowiązuje do wyłożenia kolejnej czwórki (kolejna czwórka ciągle jest niema) bądź “dokończenia” wykładania 13 kart.</td></tr>
                    <tr><td>Piątka</td><td>✧✧✧</td><td><strong>Dudniąca Piątka:</strong> Należy uderzyć ręką w stół (nie w kartę) oraz każdy musi uderzać ręką w stół po wyłożeniu karty aż do wystąpienia kolejnej piątki. Przy kolejnej piątce nie wolno już uderzyć w stół.</td></tr>
                    <tr><td>Ósemka</td><td>✧✧✧</td><td><strong>Falista Ósemka:</strong> Następna osoba w kolejce musi uderzyć obiema rękoma w stół (najpierw dalszą a potem bliższą ręką od osoby, która wyłożyła ósemkę). Osoba, która wyłożyła ósemkę powinna kontynuować falę dwoma takimi samymi uderzeniami o stół. Grę wznawia osoba po osobie, która rozpoczęła falę.</td></tr>
                </tbody>
            </table>
            <p>Czas na wykonanie każdej akcji trwa do momentu wyłożenia kolejnej karty (z wyjątkiem Falistej Ósemki).</p>

            <h3>Kruczek Prawny</h3>
            <p>Zgłaszany jest w dowolnym momencie słowami “Kruczek prawny” gdy gracz zauważa:</p>
            <ul>
                <li>Brak wykonania akcji</li>
                <li>Niepoprawnie wykonaną akcję</li>
                <li>Akcja była wykonana za późno</li>
            </ul>
            <p>Jeśli kruczek był zgłoszony słusznie to osoba, do której był on zgłoszony zbiera karty ze stosu. W przeciwnym przypadku robi to osoba zgłaszająca.</p>
        </section>
    </div>

    <!-- Modal Błędu -->
    <div id="error-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>Błąd Ruchu!</h3>
            <p id="error-message">To nie jest Twoja kolej.</p>
            <div class="modal-buttons">
                <button id="btn-undo" class="btn-secondary">Cofnij (Anuluj ruch)</button>
                <button id="btn-penalty">Zgłoś Kruczek (Przegrana)</button>
            </div>
        </div>
    </div>

    <!-- Modal Informacyjny (zamiast alert) -->
    <div id="info-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3 id="info-title">Info</h3>
            <p id="info-message"></p>
            <div class="modal-buttons">
                <button id="btn-info-ok" class="btn-secondary">OK</button>
            </div>
        </div>
    </div>

    <!-- Panel sterowania układem -->
    <div id="layout-controls" style="display:none; position: fixed; bottom: 20px; right: 20px; gap: 10px; z-index: 2000;">
        <button onclick="saveLayout()">Zapisz układ</button>
        <button onclick="cancelLayout()" class="btn-secondary">Anuluj</button>
    </div>

    <script src="state.js"></script>
    <script src="ui.js"></script>
    <script src="layout.js"></script>
    <script src="logic.js"></script>
    <script src="script.js"></script>
</body>
</html>